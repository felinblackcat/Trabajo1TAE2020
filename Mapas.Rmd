---
title: "abrir mapas"
author: "Jorge"rr
date: "4/11/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:






```{r}
library(rgdal)
library(leaflet)


dir<-paste(getwd(),"./mapas/mapa_barrios_usado", sep = "", collapse = NULL)
print(dir)

barriosShape <- readOGR( 
  dsn= dir,
  layer="Barrio_Vereda",
  verbose=TRUE
)

#geoData<-read.csv("Jorge/convertirGeodata/geoDataframe_temporal.csv",sep =';')

#barriosShape@data<-geoData

#writeOGR(cc, "./mapas/mapa_barrios_usado", "Barrio_Vereda", driver="ESRI Shapefile") #also you were missing the driver argument

#print(class(barriosShape))
#print("esto")
#b<-cc@data


```



###Vamos a crear variables categoricas para colorear
```{r}
library(dplyr)
barriosShape$numerica <- as.numeric(barriosShape$CLUSTER)

# Variable categorica
barriosShape$categorica <- case_when(barriosShape$numerica == 1 ~ "peligro moderado", barriosShape$numerica == 0 ~ "peligro bajo", barriosShape$numerica == 2 ~ "peligro alto", barriosShape$numerica == 3 ~ "no agrupado")
```
```{r}
library('BBmisc')

#dat <- barriosShape.numerica(x = rnorm(10, 30, .2), y = runif(10, 3, 5))
#norm<-normalize(barriosShape$numerica, method = "standardize", range = c(0, 1), margin = 1L, #on.constant = "quiet")


```
###Vamos a crear la paleta de colores

```{r}
library(viridis)  # paletas de colores
palnumeric <- colorNumeric("viridis", c(0,3))
palnumeric <- colorNumeric(c("aliceblue","brown4"), 0:2)

```
###POP up
```{r}
popup <- paste0("<style> div.leaflet-popup-content {width:auto !important;}</style>","<b>", "Nombre del barrio: ", "</b>", as.character(barriosShape$NOMBRE), 
    "<br>", "<b>", "Capital: ", "</b>", as.character("hola"), "<br>", 
    "<b>", "Area: ", "</b>", "dsa", "<br>", "<b>", 
    "Num. Aleatorio ", "</b>", "specify_decimal", "<br>", "<b>", 
    "Grupo al que pertenece: ", "</b>", as.character(barriosShape$categorica), "<br>",
"<table>", "<tr>",
    "<th>","tipo","</th>",
    "<th>","atropello","</th>",
    "<th>","caida ocupante","</th>",
    "<th>","choque","</th>",
    "<th>","otro","</th>",
    "<th>","volcamiento","</th>",
  "</tr>",
    "<th>","promedio","</th>",
    "<td>","cantidadatropello","</td>",
    "<td>","cantidad caida ocupante","</td>",
    "<td>","cant choque","</td>",
    "<td>","cant otro","</td>",
    "<td>","cant volca","</td>",
  "</tr>",


"</table>",
"<table>", "<tr>",
    "<th>","tipo","</th>",
    "<th>","atropello","</th>",
    "<th>","caida ocupante","</th>",
    "<th>","choque","</th>",
    "<th>","otro","</th>",
    "<th>","volcamiento","</th>",
  "</tr>",
    "<th>","promedio","</th>",
    "<td>","cantidadatropello","</td>",
    "<td>","cantidad caida ocupante","</td>",
    "<td>","cant choque","</td>",
    "<td>","cant otro","</td>",
    "<td>","cant volca","</td>",
  "</tr>",


"</table>"

)
```
###Creat mapa

```{r}



leaflet(barriosShape) %>%
  # Opcion para anadir imagenes o mapas de fondo (tiles)
  setView(-75.60272578, 6.21901553, 11) %>%
  # Funcion para agregar poligonos
  addPolygons(color = "#444444" ,
              weight = 1, 
              smoothFactor = 0.5,
              opacity = 1.0,
              fillOpacity = 0.5,
              fillColor = case_when(barriosShape$numerica != 3 ~palnumeric(barriosShape$numerica)),    # Color de llenado
              highlightOptions = highlightOptions(color = "white", weight = 2,
                                                  bringToFront = TRUE), #highlight cuando pasas el cursor
              label = ~barriosShape$NOMBRE ,                                  # etiqueta cuando pasas el cursor
              labelOptions = labelOptions(direction = "auto"),
              popup = popup)%>%addTiles(attribution = "overlay dataÂ© mapsnigeriainitiative 2016")

```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
